{% load staticfiles %}

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>A Fine Line Game</title>

		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/css/bootstrap.min.css' %}"/>
 		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/css/bootstrap-theme.min.css' %}"/>
		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/res/css/style.css' %}"/>

		<style>
		/*http://stackoverflow.com/questions/2756575/drawing-text-to-canvas-with-font-face-does-not-work-at-the-first-time*/
		#sftoontime
		{
			font-family: 'sfToontime';
			opacity:0;
			height:0;
			width:0;
			display:inline-block;
		}
		#noteworthy
		{
			font-family: 'Noteworthy';
			opacity:0;
			height:0;
			width:0;
			display:inline-block;
		}
		#noteworthylight
		{
			font-family: 'NoteworthyLight';
			opacity:0;
			height:0;
			width:0;
			display:inline-block;
		}
		#noteworthybold
		{
			font-family: 'NoteworthyBold';
			opacity:0;
			height:0;
			width:0;
			display:inline-block;
		}
		</style>

		<!-- Third Party library files -->
		<script src="{% static 'gnovel/third_party/three.js' %}"></script>
		<script src="{% static 'gnovel/third_party/Tween.js' %}"></script>
		<script src="{% static 'gnovel/third_party/stats.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three-text2d.js' %}"></script>
		<script src="{% static 'gnovel/third_party/jquery-2.2.1.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/js/bootstrap.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/soundjs-0.6.2.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/tweenjs-NEXT.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/easeljs-NEXT.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/Font.js' %}"></script>
		<script src="{% static 'gnovel/third_party/preloadjs-NEXT.min.js' %}"></script>

		<!-- Gnovel library source files -->
		<script src="{% static 'gnovel/js/gnovel/gnovel.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/page.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/transition.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/mousemovedcamera.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/cameraMove.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/choices.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/flow.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/dialog.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/interactableobject.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/util.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/multitracksplayer.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/assetloader.js' %}"></script>

		<!-- MPlay source files (not including pages) -->
		<script src="{% static 'gnovel/js/mplay/integritymanager.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/relationshipmanager.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/character.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/mplaypage.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/mplaychoices.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/spineanimation.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/phoneinteraction.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/assetlist.js' %}"></script>

		<!-- MPLAY dependency files -->
		<script src="{% static 'gnovel/third_party/spine.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/shaders/CopyShader.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/shaders/HorizontalBlurShader.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/shaders/VerticalBlurShader.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/postprocessing/EffectComposer.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/postprocessing/RenderPass.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/postprocessing/ShaderPass.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/postprocessing/TexturePass.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/shaders/VignetteShader.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three.js_extra/postprocessing/MaskPass.js' %}"></script>

		<!-- pages -->
		<script src="{% static 'gnovel/js/mplay/loadingPage.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page0_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page1_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page1_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page2_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page2_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page4_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page4_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page5_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page5_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page7_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page7_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_2_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_3_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_4.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_5.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/pageending.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/pagetest.js' %}"></script>

		<script id="vertexShader" type="x-shader/x-vertex">
			varying vec2 vUv;
			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		</script>

		<script id="fragment_shader_screen" type="x-shader/x-fragment">
			varying vec2 vUv;
			uniform sampler2D tDiffuse;
			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );
			}
		</script>

		<script>
			var getCookie = function(name) {
				var cookieValue = null;
				if (document.cookie && document.cookie != '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) == (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}
					}
				}
				return cookieValue;
			};

			var csrfSafeMethod = function(method) {
				// these HTTP methods do not require CSRF protection
				return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			};

			var init = function() {
				var gnovel = new GNOVEL.Gnovel();
				var mouseMovedCamera = new GNOVEL.MouseMovedCamera(gnovel);

				// for debugging
				// gnovel.seeStats();
				GNOVEL.gnovel = gnovel;

				var csrftoken = getCookie('csrftoken');
				$.ajaxSetup({
					beforeSend: function(xhr, settings) {
						if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
							xhr.setRequestHeader("X-CSRFToken", csrftoken);
						}
					}
				});

				// add pages
				gnovel.addPage("scene loading", MPLAY.PageLoading);
				gnovel.addPage("scene 1.b", MPLAY.Page0_1);
				gnovel.addPage("scene 2.a", MPLAY.Page1_0);
				gnovel.addPage("scene 2.b", MPLAY.Page1_1);
				gnovel.addPage("scene 3.a", MPLAY.Page2_0); // aside 1 - a
				gnovel.addPage("scene 3.b", MPLAY.Page2_1); // aside 1 - b
				gnovel.addPage("scene 4", MPLAY.Page3);
				gnovel.addPage("scene 5.a", MPLAY.Page4_0); // aside 2 - a
				gnovel.addPage("scene 5.b", MPLAY.Page4_1); // aside 2 - b
				gnovel.addPage("scene 6.a", MPLAY.Page5_0);
				gnovel.addPage("scene 6.b", MPLAY.Page5_1);
				gnovel.addPage("scene 7.a", MPLAY.Page6_0); // aside 3 -a
				gnovel.addPage("scene 7.b", MPLAY.Page6_1); // aside 3 -b
				gnovel.addPage("scene 7.c", MPLAY.Page6_2); // aside 3 -c
				gnovel.addPage("scene 8.a", MPLAY.Page7_0);
				gnovel.addPage("scene 8.b", MPLAY.Page7_1);
				gnovel.addPage("scene 9.a", MPLAY.Page8_0); // ending 1
				gnovel.addPage("scene 9.b", MPLAY.Page8_1); // ending 2
				gnovel.addPage("scene 9.c", MPLAY.Page8_2); // ending 3 - part 1
				gnovel.addPage("scene 9.c.a", MPLAY.Page8_2_1); // ending 3 - part 2
				gnovel.addPage("scene 9.d", MPLAY.Page8_3); // ending 4 - part 1
				gnovel.addPage("scene 9.d.a", MPLAY.Page8_3_1); // ending 4 - part 2
				gnovel.addPage("scene 9.e", MPLAY.Page8_4); // ending 5
				gnovel.addPage("scene 9.f", MPLAY.Page8_5); // ending 6
				gnovel.addPage("scene 10.a", MPLAY.Page9_0); // animal house ending
				gnovel.addPage("scene 10.b", MPLAY.Page9_1); // animal house ending
				gnovel.addPage("scene 10.c", MPLAY.Page9_2); // animal house ending
				gnovel.addPage("scene 10.d", MPLAY.Page9_3); // animal house ending
				gnovel.addPage("scene ending", MPLAY.PageEnding);
				gnovel.addPage("test", MPLAY.PageTest);

				// start gnovel
				gnovel.start();
			};
		</script>
	</head>
	<body onload='init();'>
		{{ text }}
		{% csrf_token %}
		<div id='username' style="display: none;">{{ name }}</div>
		<div id='container'>
				<img src="{% static 'gnovel/res/result/paper background.png' %}" style="height:100%; width:100%; top:0; left:0; position:fixed;"/>
	        <canvas id='application-canvas' class='fill-mode-KEEP_ASPECT' width='1920' height='1032' >
	            JavaScript Not Enabled.
	        </canvas>
		</div>
		<div id="footer">
			<a class='title' href='http://www.etc.cmu.edu/projects/true-north/' target='_blank'>
					<div class='img'></div>
			</a>
		</div>

		<form id="post_result_form">
			{% csrf_token %}
		</form>

		<div id='sftoontime'>.</div>
		<div id='noteworthy'>.</div>
		<div id='noteworthylight'>.</div>
		<div id='noteworthybold'>.</div>

	</body>
</html>
