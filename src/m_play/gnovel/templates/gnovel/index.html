{% load staticfiles %}

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Morality Play</title>

		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/css/bootstrap.min.css' %}"/>
		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/css/bootstrap-theme.min.css' %}"/>	
		<link rel='stylesheet' type='text/css' href="{% static 'gnovel/res/css/style.css' %}"/>		

		<!-- Third Party library files -->
		<script src="{% static 'gnovel/third_party/three.js' %}"></script>
		<script src="{% static 'gnovel/third_party/Tween.js' %}"></script>
		<script src="{% static 'gnovel/third_party/stats.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/three-text2d.js' %}"></script>
		<script src="{% static 'gnovel/third_party/jquery-2.2.1.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/bootstrap-3.3.6-dist/js/bootstrap.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/soundjs-0.6.2.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/tweenjs-NEXT.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/easeljs-NEXT.min.js' %}"></script>
		<script src="{% static 'gnovel/third_party/Font.js' %}"></script>
		<script src="{% static 'gnovel/third_party/preloadjs-NEXT.min.js' %}"></script>

		<!-- Gnovel library source files -->
		<script src="{% static 'gnovel/js/gnovel/gnovel.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/page.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/transition.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/mousemovedcamera.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/choices.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/flow.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/dialog.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/interactableobject.js' %}"></script>
		<script src="{% static 'gnovel/js/gnovel/util.js' %}"></script>

		<!-- MPlay source files (not including pages) -->
		<script src="{% static 'gnovel/js/mplay/integritymanager.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/relationshipmanager.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/character.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/mplaypage.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/mplaychoices.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/spineanimation.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/phoneinteraction.js' %}"></script>

		<!-- MPLAY dependency files -->
		<script src="{% static 'gnovel/third_party/spine.js' %}"></script>

		<!-- pages -->
		<script src="{% static 'gnovel/js/mplay/page0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page0_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page1_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page1_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page2_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page2_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page4_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page4_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page5_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page5_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page6_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page7_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page7_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_4.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page8_5.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_0.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_1.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_2.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/page9_3.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/pageending.js' %}"></script>
		<script src="{% static 'gnovel/js/mplay/pagetest.js' %}"></script>

		<script>
			var getCookie = function(name) {
				var cookieValue = null;
				if (document.cookie && document.cookie != '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) == (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}
					}
				}
				return cookieValue;
			};

			var csrfSafeMethod = function(method) {
				// these HTTP methods do not require CSRF protection
				return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			};

			var init = function() {
				var gnovel = new GNOVEL.Gnovel();
				var mouseMovedCamera = new GNOVEL.MouseMovedCamera(gnovel);

				// for debugging
				gnovel.seeStats();
				GNOVEL.gnovel = gnovel;

				var csrftoken = getCookie('csrftoken');
				$.ajaxSetup({
					beforeSend: function(xhr, settings) {
						if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
							xhr.setRequestHeader("X-CSRFToken", csrftoken);
						}
					}
				});

				// add pages
				gnovel.addPage("scene 1", MPLAY.Page0);
				gnovel.addPage("scene 1.b", MPLAY.Page0_1);
				gnovel.addPage("scene 2.a", MPLAY.Page1_0);
				gnovel.addPage("scene 2.b", MPLAY.Page1_1);
				gnovel.addPage("scene 3.a", MPLAY.Page2_0);
				gnovel.addPage("scene 3.b", MPLAY.Page2_1);
				gnovel.addPage("scene 4", MPLAY.Page3);
				gnovel.addPage("scene 5.a", MPLAY.Page4_0);
				gnovel.addPage("scene 5.b", MPLAY.Page4_1);
				gnovel.addPage("scene 6.a", MPLAY.Page5_0);
				gnovel.addPage("scene 6.a", MPLAY.Page5_0);
				gnovel.addPage("scene 6.b", MPLAY.Page5_1);
				gnovel.addPage("scene 7.a", MPLAY.Page6_0);
				gnovel.addPage("scene 7.b", MPLAY.Page6_1);
				gnovel.addPage("scene 7.c", MPLAY.Page6_2);
				gnovel.addPage("scene 8.a", MPLAY.Page7_0);
				gnovel.addPage("scene 8.b", MPLAY.Page7_1);
				gnovel.addPage("scene 9.a", MPLAY.Page8_0);
				gnovel.addPage("scene 9.b", MPLAY.Page8_1);
				gnovel.addPage("scene 9.c", MPLAY.Page8_2);
				gnovel.addPage("scene 9.d", MPLAY.Page8_3);
				gnovel.addPage("scene 9.e", MPLAY.Page8_4);
				gnovel.addPage("scene 9.f", MPLAY.Page8_5);
				gnovel.addPage("scene 10.a", MPLAY.Page9_0);
				gnovel.addPage("scene 10.b", MPLAY.Page9_1);
				gnovel.addPage("scene 10.c", MPLAY.Page9_2);
				gnovel.addPage("scene 10.d", MPLAY.Page9_3);
				gnovel.addPage("scene ending", MPLAY.PageEnding);
				gnovel.addPage("test", MPLAY.PageTest);

				// start gnovel
				gnovel.start();
			};
		</script>
	</head>
	<body onload='init();'>
		{{ text }}
		{% csrf_token %}
		<div id='username' style="display: none;">{{ name }}</div>
		<div id='container'>
	        <canvas id='application-canvas' width='1920' height='1080' >
	            JavaScript Not Enabled.
	        </canvas>
		</div>
	</body>
</html>
